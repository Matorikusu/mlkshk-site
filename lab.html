<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MLKSHK LAB</title>
<link rel="icon" href="images/LOGO_SMALL.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;600;700&family=Rajdhani:wght@500;600&display=swap" rel="stylesheet">
<style>
/* ── Your existing styles here (kept unchanged, just adding chat enhancements) ── */
:root {
  --bg: #000;
  --text: #f5f5f5;
  --muted: #c0c0c0;
  --accent: #ff2aa1;
  --card-radius: 12px;
}
body { margin:0; padding:0; font-family:'Rajdhani', sans-serif; background:var(--bg); color:var(--text); }

/* ... your full existing CSS ... */

/* Chat enhancements */
.chat-window {
  width:100%; 
  height:280px; /* taller for better usability */
  border:1px solid rgba(255,42,161,0.3); 
  border-radius:12px;
  padding:15px; 
  margin-bottom:15px; 
  background: rgba(255,255,255,0.04); 
  overflow-y:auto;
  font-size:14px;
  line-height:1.5;
}
.chat-message {
  margin-bottom:10px;
}
.chat-message strong { color: var(--accent); }
.chat-inputs {
  display:flex; 
  gap:10px; 
  align-items:center; 
  justify-content:center; 
  flex-wrap:wrap;
}
.chat-inputs input[type="text"] { 
  width:180px; 
  padding:12px; 
  border-radius:12px; 
  border:1px solid rgba(255,255,255,0.1); 
  background: rgba(255,255,255,0.03); 
  color:#fff; 
}
.chat-inputs textarea { 
  flex:1; 
  padding:12px; 
  border-radius:12px; 
  border:1px solid rgba(255,255,255,0.1); 
  background: rgba(255,255,255,0.03); 
  color:#fff; 
  resize:none; 
  min-height:48px; 
}
.chat-inputs button { 
  padding:12px 28px; 
  border-radius:30px; 
  border:none; 
  background:var(--accent); 
  color:#000; 
  font-weight:700; 
  cursor:pointer; 
}
.chat-inputs button:hover { background:#ff5bc3; }
.chat-inputs button:disabled { opacity:0.4; cursor:not-allowed; }

/* Password section */
.password-section { text-align:center; margin:40px 0; }
#passwordInput { 
  padding:12px 16px; 
  width:220px; 
  border-radius:12px; 
  border:none; 
  background:rgba(255,255,255,0.05); 
  color:#fff; 
}
#unlockBtn { 
  padding:12px 24px; 
  margin-left:10px; 
  border-radius:12px; 
  background:var(--accent); 
  color:#000; 
  border:none; 
  font-weight:700; 
  cursor:pointer; 
}
.locked-note { color:#ff5bc3; font-weight:600; }

/* Floating player (your existing styles) */
#floating-player { /* ... your existing floating player CSS ... */ }
</style>
</head>
<body>

<!-- Your existing header, hero, rules, spotify embed, lyrics, etc. -->

<!-- LIVE CHAT - now password protected -->
<section class="chat-container">
  <h2>Live Lab Chat</h2>
  <p class="note">Reserved for official MLKSHK artists. Password required.</p>

  <div id="lockedChat" style="text-align:center; padding:30px; background:rgba(255,42,161,0.05); border-radius:12px;">
    <p class="locked-note">Enter password to join chat</p>
    <input type="password" id="passwordInput" placeholder="Lab access code">
    <button id="unlockBtn">Unlock</button>
  </div>

  <div id="chatContent" style="display:none;">
    <div class="chat-window" id="chatWindow"></div>
    <div class="chat-inputs">
      <input type="text" id="username" placeholder="Your artist name" maxlength="20">
      <textarea id="message" placeholder="Type your message..."></textarea>
      <button id="sendBtn">Send</button>
    </div>
  </div>
</section>

<!-- Your existing password section (if you want to keep it separate), form, note, etc. -->

<!-- FLOATING PLAYER (unchanged from previous) -->
<div id="floating-player">
  <div class="player-meta">
    <div class="player-title">MLKSHK Pirate Radio</div>
    <div class="player-artist">Live Stream</div>
    <div class="player-status" id="status">Ready</div>
  </div>
  <div class="player-controls">
    <img id="playPause" src="Player/PLAY.png" alt="Play/Pause">
  </div>
  <audio id="audio">
    <source src="https://radio.mlkshkdigital.com/stream.mp3" type="audio/mpeg">
  </audio>
</div>

<!-- Optional: manual pause helper near Spotify if needed -->
<p class="note" style="text-align:center; margin:20px 0;">
  If Spotify beat clashes with radio stream, use the floating player controls or refresh.
</p>

<script>
// ── Floating player (your existing code) ──
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playPause');
const statusEl = document.getElementById('status');

playBtn.onclick = () => {
  if (audio.paused) {
    audio.play().catch(e => statusEl.textContent = 'Error – try again');
    playBtn.src = 'Player/PAUSE.png';
    statusEl.textContent = 'Connecting...';
  } else {
    audio.pause();
    playBtn.src = 'Player/PLAY.png';
    statusEl.textContent = 'Paused';
  }
};

// ... your existing audio event listeners + Media Session code ...

// ── Password unlock for chat ──
const CORRECT_PASSWORD = "mlkshk-lab-2026"; // ← CHANGE THIS to your real password!

document.getElementById('unlockBtn').onclick = () => {
  const input = document.getElementById('passwordInput').value.trim();
  if (input === CORRECT_PASSWORD) {
    document.getElementById('lockedChat').style.display = 'none';
    document.getElementById('chatContent').style.display = 'block';
    addSystemMessage("Welcome to the Lab chat. Keep it creative.");
  } else {
    alert("Access denied. Wrong code.");
    document.getElementById('passwordInput').value = '';
  }
};

// ── Simple in-memory chat ──
const chatWindow = document.getElementById('chatWindow');
const usernameInput = document.getElementById('username');
const messageInput = document.getElementById('message');
const sendBtn = document.getElementById('sendBtn');

let messages = []; // stored in memory (lost on refresh)

function addMessage(user, text) {
  messages.push({ user, text, time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) });
  renderChat();
}

function addSystemMessage(text) {
  addMessage("System", text);
}

function renderChat() {
  chatWindow.innerHTML = '';
  messages.forEach(msg => {
    const div = document.createElement('div');
    div.className = 'chat-message';
    div.innerHTML = `<strong>${msg.user}</strong> <span style="opacity:0.6; font-size:0.9em;">${msg.time}</span><br>${msg.text}`;
    chatWindow.appendChild(div);
  });
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

sendBtn.onclick = () => {
  const user = usernameInput.value.trim() || "Anonymous";
  const text = messageInput.value.trim();
  if (text) {
    addMessage(user, text);
    messageInput.value = '';
  }
};

messageInput.addEventListener('keypress', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendBtn.click();
  }
});

// Initial welcome
addSystemMessage("Chat unlocked for artists only. Be excellent to each other.");

// Optional: try to detect Spotify play (very limited reliability)
const spotifyIframe = document.querySelector('iframe[src*="spotify.com/embed"]');
if (spotifyIframe) {
  window.addEventListener('message', e => {
    // Spotify sometimes sends playback state via postMessage (not always reliable)
    if (e.source === spotifyIframe.contentWindow && e.data?.command) {
      if (e.data.command === 'play' || e.data.command === 'toggle') {
        if (!audio.paused) {
          audio.pause();
          playBtn.src = 'Player/PLAY.png';
          statusEl.textContent = 'Paused (Spotify active)';
        }
      }
    }
  });
}
</script>
</body>
</html>
